<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Time-Series with custom RNN cell</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.8.0.9000/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.40.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.40.1/plotly-latest.min.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.0/grViz.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
  <div class="container">
  <div class="navbar-header">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
    <i class="fa fa-bars fa-lg fa-inverse"></i>
  </button>
  <a class="navbar-brand" href="index.html">MXNET R</a>
  </div>
  
  <div id="navbar" class="collapse navbar-collapse">
  <ul class="nav navbar-nav">
    
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Language Model<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="LanguageModel_GPU.html">GPU</a></li>
        <li><a href="LanguageModel_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">NLP Classification<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="NLP_Classification_GPU.html">GPU</a></li>
        <li><a href="NLP_Classification_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Time Series<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="TimeSeries_GPU.html">GPU</a></li>
        <li><a href="TimeSeries_CPU.html">CPU</a></li>
        </ul>
  </li>
  
    <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Vision<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="ClassActivationMap.html">Activation Map</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Translation<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="">GPU</a></li>
        <li><a href="">CPU</a></li>
        </ul>
  </li>
  
  <li><a href="CNN_NLP_Classification.html">CNN NLP Classification</a></li>
  
  </ul>
  
  <ul class="nav navbar-nav navbar-right">
    <li class=navbar-right><a href="mailto:nimus44@gmail.com" ><i class="fa fa-envelope fa-lg"></i></a></li>
    <li class=navbar-right><a href="https://github.com/jeremiedb" ><i class="fa fa-github fa-lg"></i></a></li>
  </ul>
  
  </div><!--/.nav-collapse -->
  </div><!--/.container -->
  </nav><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Time-Series with custom RNN cell</h1>

</div>


<p>This is a minimalistic demo on how to model time-series with RNN, including training and inference.</p>
<p>Rather than relying on the <code>mx.symbol.RNN</code> operator which provides a convenient and efficient implementation of common RNN cells such as the LSTM and GRU, the following example relies on a manual construction of the RNN cells and provides a structure from which alternative cells can be implemented.</p>
<pre class="r"><code>library(&quot;readr&quot;)
library(&quot;dplyr&quot;)
library(&quot;plotly&quot;)
library(&quot;mxnet&quot;)</code></pre>
<div id="data-preparation" class="section level3">
<h3>Data preparation</h3>
<p>In this step, a dataset made of multiple univariate time-series is built. 500 independent times series (<em>n</em>) with each 100 observations (<em>seq_len</em>) are created.</p>
<p>The modeling task will be to predict the next value given the previous ones. The target variable can therefore be obtained by shifting the features by one timestep in the future.</p>
<p>The resulting data is of shape [1, 100, 500] corresponding to [num_features, seq_length, samples]. In multivariate time-series, the dataset would follow the same structure, except that the num_features would be &gt; 1.</p>
<pre class="r"><code># number of timestamps
seq_len = 100

# number of samples
n = 500

# return a random starting point of the time series
set.seed(12)
seeds &lt;- runif(n, min = 0, max = 24)

# generate the time series of seq_length for each starting point
pts &lt;- sapply(seeds, function(x) sin(x + pi/12 * (0:(seq_len))))

# build the features matrix
x &lt;- pts[1:seq_len, ]
x &lt;- array(x, dim = c(1, seq_len, n))

# build the target array - same as feature but one timestep forward
y &lt;- pts[-1, ]

# plot time series from 5 first samples
plot_ly(x = 1:dim(x)[2], y = x[,,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,2], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,3], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,4], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,5], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  layout(title = &quot;Sample of 5 time series&quot;)</code></pre>
<div id="htmlwidget-5359762f84bab53d6980" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-5359762f84bab53d6980">{"x":{"visdat":{"4b384f401c41":["function () ","plotlyVisDat"]},"cur_data":"4b384f401c41","attrs":{"4b384f401c41":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b384f401c41.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.70117834568943,0.861820608905392,0.963731221850346,0.999965144667347,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700609,0.266874749706372,0.00834921855102572,-0.250745298050841,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456416,-0.712985923799507,-0.507213207700609,-0.266874749706372,-0.00834921855102584,0.25074529805084,0.492751936966736,0.701178345689429,0.861820608905392,0.963731221850346,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799507,0.50721320770061,0.266874749706376,0.00834921855102596,-0.25074529805084,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456418,-0.712985923799507,-0.50721320770061,-0.266874749706373,-0.00834921855102609,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850347,0.999965144667346,0.968053095395803,0.870169827456416,0.71298592379951,0.507213207700607,0.266874749706376,0.00834921855102621,-0.25074529805084,-0.492751936966733,-0.701178345689427,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395804,-0.870169827456414,-0.712985923799508,-0.50721320770061,-0.266874749706373,-0.00834921855102988,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850345,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700613,0.266874749706376,0.00834921855102645,-0.250745298050833,-0.492751936966739,-0.701178345689426,-0.861820608905389,-0.963731221850346,-0.999965144667346,-0.968053095395803,-0.870169827456418,-0.712985923799508,-0.50721320770061,-0.26687474970638,-0.00834921855102302,0.250745298050836,0.492751936966735,0.701178345689429,0.861820608905388,0.963731221850346,0.999965144667346],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"4b384f401c41.2":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345788,-0.403578406307372,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254405,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.932336886940122,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823962,-0.107963379671007,-0.361590831259314,-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233053,-0.626632013345788,-0.403578406307375,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254402,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823959,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904059,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233055,-0.626632013345785,-0.403578406307375,-0.153021597823963,0.107963379671006,0.36159083125931,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.93233688694012,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823966,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904056,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345791,-0.403578406307376,-0.153021597823963,0.107963379670999,0.361590831259317,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605102,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307379,0.153021597823959,-0.107963379671003,-0.361590831259313,-0.590576465254404,-0.779315289116156,-0.914945063904059,-0.988222844605103],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"4b384f401c41.3":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.180976961168064,0.429355573857644,0.648474313732461,0.823400600780882,0.942213497619918,0.996816101677582,0.983487335722414,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989953,0.0797349323465505,-0.180976961168064,-0.429355573857644,-0.64847431373246,-0.823400600780882,-0.942213497619917,-0.996816101677582,-0.983487335722414,-0.903135533127433,-0.761236536451854,-0.567460527819938,-0.335013021989954,-0.0797349323465524,0.180976961168064,0.429355573857644,0.64847431373246,0.823400600780882,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989955,0.0797349323465525,-0.180976961168064,-0.429355573857642,-0.64847431373246,-0.823400600780883,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127433,-0.761236536451853,-0.567460527819938,-0.335013021989957,-0.0797349323465527,0.180976961168064,0.429355573857645,0.64847431373246,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451856,0.567460527819938,0.335013021989954,0.0797349323465528,-0.18097696116806,-0.429355573857642,-0.64847431373246,-0.823400600780881,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989957,-0.0797349323465529,0.180976961168063,0.429355573857642,0.648474313732459,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127434,0.761236536451856,0.567460527819939,0.335013021989957,0.079734932346553,-0.180976961168063,-0.429355573857642,-0.648474313732459,-0.82340060078088,-0.942213497619917,-0.996816101677581,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989958,-0.0797349323465531,0.180976961168063,0.429355573857642,0.648474313732462,0.82340060078088],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"4b384f401c41.4":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871935,-0.921386408957596,-0.78940148493583,-0.603620154263324,-0.376703107607241,-0.124114366699045,0.136932563191003,0.388647765191344,0.613877264264695,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263324,0.376703107607241,0.124114366699045,-0.136932563191002,-0.388647765191345,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607241,-0.124114366699045,0.136932563191002,0.388647765191343,0.613877264264693,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935832,0.603620154263324,0.376703107607242,0.124114366699045,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191344,0.613877264264693,0.797272042258549,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263325,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263326,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191341,0.613877264264693,0.797272042258551,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935833,0.603620154263326,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Sample of 5 time series","xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.70117834568943,0.861820608905392,0.963731221850346,0.999965144667347,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700609,0.266874749706372,0.00834921855102572,-0.250745298050841,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456416,-0.712985923799507,-0.507213207700609,-0.266874749706372,-0.00834921855102584,0.25074529805084,0.492751936966736,0.701178345689429,0.861820608905392,0.963731221850346,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799507,0.50721320770061,0.266874749706376,0.00834921855102596,-0.25074529805084,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456418,-0.712985923799507,-0.50721320770061,-0.266874749706373,-0.00834921855102609,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850347,0.999965144667346,0.968053095395803,0.870169827456416,0.71298592379951,0.507213207700607,0.266874749706376,0.00834921855102621,-0.25074529805084,-0.492751936966733,-0.701178345689427,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395804,-0.870169827456414,-0.712985923799508,-0.50721320770061,-0.266874749706373,-0.00834921855102988,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850345,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700613,0.266874749706376,0.00834921855102645,-0.250745298050833,-0.492751936966739,-0.701178345689426,-0.861820608905389,-0.963731221850346,-0.999965144667346,-0.968053095395803,-0.870169827456418,-0.712985923799508,-0.50721320770061,-0.26687474970638,-0.00834921855102302,0.250745298050836,0.492751936966735,0.701178345689429,0.861820608905388,0.963731221850346,0.999965144667346],"mode":"lines","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345788,-0.403578406307372,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254405,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.932336886940122,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823962,-0.107963379671007,-0.361590831259314,-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233053,-0.626632013345788,-0.403578406307375,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254402,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823959,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904059,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233055,-0.626632013345785,-0.403578406307375,-0.153021597823963,0.107963379671006,0.36159083125931,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.93233688694012,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823966,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904056,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345791,-0.403578406307376,-0.153021597823963,0.107963379670999,0.361590831259317,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605102,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307379,0.153021597823959,-0.107963379671003,-0.361590831259313,-0.590576465254404,-0.779315289116156,-0.914945063904059,-0.988222844605103],"mode":"lines","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.180976961168064,0.429355573857644,0.648474313732461,0.823400600780882,0.942213497619918,0.996816101677582,0.983487335722414,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989953,0.0797349323465505,-0.180976961168064,-0.429355573857644,-0.64847431373246,-0.823400600780882,-0.942213497619917,-0.996816101677582,-0.983487335722414,-0.903135533127433,-0.761236536451854,-0.567460527819938,-0.335013021989954,-0.0797349323465524,0.180976961168064,0.429355573857644,0.64847431373246,0.823400600780882,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989955,0.0797349323465525,-0.180976961168064,-0.429355573857642,-0.64847431373246,-0.823400600780883,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127433,-0.761236536451853,-0.567460527819938,-0.335013021989957,-0.0797349323465527,0.180976961168064,0.429355573857645,0.64847431373246,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451856,0.567460527819938,0.335013021989954,0.0797349323465528,-0.18097696116806,-0.429355573857642,-0.64847431373246,-0.823400600780881,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989957,-0.0797349323465529,0.180976961168063,0.429355573857642,0.648474313732459,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127434,0.761236536451856,0.567460527819939,0.335013021989957,0.079734932346553,-0.180976961168063,-0.429355573857642,-0.648474313732459,-0.82340060078088,-0.942213497619917,-0.996816101677581,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989958,-0.0797349323465531,0.180976961168063,0.429355573857642,0.648474313732462,0.82340060078088],"mode":"lines","type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871935,-0.921386408957596,-0.78940148493583,-0.603620154263324,-0.376703107607241,-0.124114366699045,0.136932563191003,0.388647765191344,0.613877264264695,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263324,0.376703107607241,0.124114366699045,-0.136932563191002,-0.388647765191345,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607241,-0.124114366699045,0.136932563191002,0.388647765191343,0.613877264264693,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935832,0.603620154263324,0.376703107607242,0.124114366699045,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191344,0.613877264264693,0.797272042258549,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263325,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263326,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191341,0.613877264264693,0.797272042258551,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935833,0.603620154263326,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936],"mode":"lines","type":"scatter","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"line":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<pre class="r"><code># plot first time series and its associated target
plot_ly(x = 1:dim(x)[2], y = x[,,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;, name = &quot;feature&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = y[,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;, name = &quot;target&quot;) %&gt;% 
  layout(title = &quot;Sample of one time series&quot;)</code></pre>
<div id="htmlwidget-a74b8cf5905f19d81eab" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a74b8cf5905f19d81eab">{"x":{"visdat":{"4b3814a81077":["function () ","plotlyVisDat"]},"cur_data":"4b3814a81077","attrs":{"4b3814a81077":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","name":"feature","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b3814a81077.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"target","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Sample of one time series","xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","name":"feature","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"target","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="create-data-iterators" class="section level3">
<h3>Create data iterators</h3>
<p>The training and evaluation data are obtained by splitting the first 400 and the remaining observations into different <code>mx.io.arrayiter</code> iterators.</p>
<pre class="r"><code>batch.size = 32

# take first 400 samples for train - remaining 100 for evaluation
train_ids &lt;- 1:400

train.data &lt;- mx.io.arrayiter(data = x[,,train_ids, drop = F], label = y[, train_ids], 
                              batch.size = batch.size, shuffle = TRUE)

eval.data &lt;- mx.io.arrayiter(data = x[,,-train_ids, drop = F], label = y[, -train_ids], 
                              batch.size = batch.size, shuffle = FALSE)</code></pre>
</div>
<div id="model-architecture" class="section level3">
<h3>Model architecture</h3>
<p>R-package provides a helper function, <code>rnn.graph.unroll</code>, to build the explicit graphs for LSTM and GRU. Here a graph with only 2 time-steps is built so as to have a reasonable size for display.</p>
<pre class="r"><code>symbol &lt;- rnn.graph.unroll(seq_len = 2, 
                           num_rnn_layer =  1, 
                           num_hidden = 50,
                           input_size = NULL,
                           num_embed = NULL, 
                           num_decode = 1,
                           masking = F, 
                           loss_output = &quot;linear&quot;,
                           dropout = 0.2, 
                           ignore_label = -1,
                           cell_type = &quot;lstm&quot;,
                           output_last_state = F,
                           config = &quot;one-to-one&quot;)

graph = graph.viz(symbol, type = &quot;graph&quot;, direction = &quot;TD&quot;, 
                  shape=list(data = c(1, 2, batch.size), 
                             label = c(2, batch.size)))</code></pre>
<div id="htmlwidget-8cb4f54447ec53827770" style="width:672px;height:1152px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8cb4f54447ec53827770">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TD\"]\n\n\n\n  \"1\" [label = \"data\ndata\", shape = \"oval\", penwidth = \"2\", color = \"#8dd3c7\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#8DD3C7FF\"] \n  \"2\" [label = \"SwapAxis\nswap_pre\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"3\" [label = \"SliceChannel\nsplit0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"4\" [label = \"FullyConnected\nt1.l1.i2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"5\" [label = \"SliceChannel\nt1.l1.slice\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"6\" [label = \"Activation\nactivation3\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"7\" [label = \"Activation\nactivation0\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"8\" [label = \"Activation\nactivation1\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"9\" [label = \"elemwise_mul\n_mul0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"10\" [label = \"Activation\nactivation4\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"11\" [label = \"elemwise_mul\n_mul1\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"12\" [label = \"FullyConnected\nt2.l1.i2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"13\" [label = \"FullyConnected\nt2.l1.h2h\n200\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"14\" [label = \"elemwise_add\n_plus0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"15\" [label = \"SliceChannel\nt2.l1.slice\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"16\" [label = \"Activation\nactivation8\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"17\" [label = \"Activation\nactivation7\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"18\" [label = \"elemwise_mul\n_mul2\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"19\" [label = \"Activation\nactivation5\nsigmoid\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"20\" [label = \"Activation\nactivation6\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"21\" [label = \"elemwise_mul\n_mul3\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"22\" [label = \"elemwise_add\n_plus1\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"23\" [label = \"Activation\nactivation9\ntanh\", shape = \"box\", penwidth = \"2\", color = \"#ffffb3\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FFFFB3FF\"] \n  \"24\" [label = \"elemwise_mul\n_mul4\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"25\" [label = \"Concat\nconcat\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"26\" [label = \"Reshape\nrnn_reshape\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"27\" [label = \"_copy\nmask\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"28\" [label = \"SwapAxis\nswap_post\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"29\" [label = \"Reshape\nreshape0\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"30\" [label = \"FullyConnected\ndecode\n1\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"31\" [label = \"Reshape\nreshape1\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"32\" [label = \"LinearRegressionOutput\nloss\", shape = \"box\", penwidth = \"2\", color = \"#b3de69\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#B3DE69FF\"] \n\"1\"->\"2\" [color = \"black\", fontcolor = \"black\", label = \"1X2X32\"] \n\"2\"->\"3\" [color = \"black\", fontcolor = \"black\", label = \"1X32X2\"] \n\"3\"->\"4\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"4\"->\"5\" [color = \"black\", fontcolor = \"black\", label = \"200X32\"] \n\"5\"->\"6\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"5\"->\"7\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"5\"->\"8\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"7\"->\"9\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"8\"->\"9\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"9\"->\"10\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"6\"->\"11\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"10\"->\"11\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"3\"->\"12\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"11\"->\"13\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"12\"->\"14\" [color = \"black\", fontcolor = \"black\", label = \"200X32\"] \n\"13\"->\"14\" [color = \"black\", fontcolor = \"black\", label = \"200X32\"] \n\"14\"->\"15\" [color = \"black\", fontcolor = \"black\", label = \"200X32\"] \n\"15\"->\"16\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"15\"->\"17\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"17\"->\"18\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"9\"->\"18\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"15\"->\"19\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"15\"->\"20\" [color = \"black\", fontcolor = \"black\", fontcolor = \"black\"] \n\"19\"->\"21\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"20\"->\"21\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"18\"->\"22\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"21\"->\"22\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"22\"->\"23\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"16\"->\"24\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"23\"->\"24\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"11\"->\"25\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"24\"->\"25\" [color = \"black\", fontcolor = \"black\", label = \"50X32\"] \n\"25\"->\"26\" [color = \"black\", fontcolor = \"black\", label = \"50X64\"] \n\"26\"->\"27\" [color = \"black\", fontcolor = \"black\", label = \"50X32X2\"] \n\"27\"->\"28\" [color = \"black\", fontcolor = \"black\", label = \"50X32X2\"] \n\"28\"->\"29\" [color = \"black\", fontcolor = \"black\", label = \"50X2X32\"] \n\"29\"->\"30\" [color = \"black\", fontcolor = \"black\", label = \"50X64\"] \n\"30\"->\"32\" [color = \"black\", fontcolor = \"black\", label = \"1X64\"] \n\"31\"->\"32\" [color = \"black\", fontcolor = \"black\", label = \"64\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>Now the complete graph can be built by specifying a sequence length matching the data (<em>seq_len</em> = 50).</p>
<pre class="r"><code>symbol &lt;- rnn.graph.unroll(seq_len = seq_len, 
                           num_rnn_layer =  2, 
                           num_hidden = 50,
                           input_size = NULL,
                           num_embed = NULL, 
                           num_decode = 1,
                           masking = F, 
                           loss_output = &quot;linear&quot;,
                           dropout = 0.1, 
                           ignore_label = -1,
                           cell_type = &quot;lstm&quot;,
                           output_last_state = F,
                           config = &quot;one-to-one&quot;)</code></pre>
</div>
<div id="fit-a-lstm-model" class="section level3">
<h3>Fit a LSTM model</h3>
<p>Prior to training, a custom metric is defined to handle labels that are in a 2D (matrix) format rather than in a flat vector as in vanilla regression models.</p>
<pre class="r"><code>mx.metric.mse.seq &lt;- mx.metric.custom(&quot;MSE&quot;, function(label, pred) {
  label = mx.nd.reshape(label, shape = -1)
  pred = mx.nd.reshape(pred, shape = -1)
  res &lt;- mx.nd.mean(mx.nd.square(label-pred))
  return(as.array(res))
})</code></pre>
<pre class="r"><code>ctx &lt;- mx.cpu()

initializer &lt;- mx.init.Xavier(rnd_type = &quot;gaussian&quot;, 
                              factor_type = &quot;avg&quot;, 
                              magnitude = 2.5)

optimizer &lt;- mx.opt.create(&quot;adadelta&quot;, rho = 0.9, eps = 1e-5, wd = 0,
                           clip_gradient = 1, rescale.grad = 1/batch.size)

logger &lt;- mx.metric.logger()
epoch.end.callback &lt;- mx.callback.log.train.metric(period = 10, logger = logger)

system.time(
  model &lt;- mx.model.buckets(symbol = symbol,
                            train.data = train.data, 
                            eval.data = eval.data, 
                            num.round = 60, ctx = ctx, verbose = TRUE,
                            metric = mx.metric.mse.seq, 
                            initializer = initializer, optimizer = optimizer, 
                            batch.end.callback = NULL, 
                            epoch.end.callback = epoch.end.callback)
)</code></pre>
<pre><code>##    user  system elapsed 
##  428.75  361.55  156.08</code></pre>
<pre class="r"><code>plot_ly(x = seq_len(length(logger$train)), y = logger$train, type = &quot;scatter&quot;, 
        mode = &quot;markers+lines&quot;, name = &quot;train&quot;) %&gt;% 
  add_trace(y = logger$eval, type = &quot;scatter&quot;, 
            mode = &quot;markers+lines&quot;, name = &quot;eval&quot;)</code></pre>
<div id="htmlwidget-9c178ac47f0bf5ab798d" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9c178ac47f0bf5ab798d">{"x":{"visdat":{"4b38267d1b52":["function () ","plotlyVisDat"]},"cur_data":"4b38267d1b52","attrs":{"4b38267d1b52":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.178007185459137,0.0551108028739691,0.0345983966611899,0.0317474809976724,0.0287826635803168,0.0219044820047342,0.0242414973103083,0.0195118516970139,0.0198569024841373,0.0175732461592326,0.0184457838678589,0.0127857535934219,0.0154161130866179,0.0113792738948877,0.0160008532066758,0.0111887793128307,0.0130413767810051,0.0128459345119504,0.00899791670963168,0.0117738740518689,0.010124161051443,0.0113964737034761,0.00815677768192612,0.0081835172067468,0.0100849006826488,0.00962175611549845,0.00694748139582001,0.00794698903337121,0.0083109952437763,0.00882133597937914,0.00648390978144912,0.00690347081623398,0.00716124772309111,0.00877142851599134,0.00660272096641935,0.0070246965982593,0.007185609294818,0.00651203661870498,0.00683589172191345,0.00639475885635385,0.00721525626543623,0.00602281365830165,0.00617926499734704,0.00674548369044295,0.00639580344208158,0.00572485075547145,0.00555707682640507,0.006820011131752,0.00542051452570237,0.00567840297634785,0.00602349581626745,0.0057072788835145,0.00545391726952333,0.00562030610700066,0.0059168402535411,0.00501133677048179,0.00513407534274917,0.00595602844483577,0.00502715804255926,0.00509184498626452],"mode":"markers+lines","name":"train","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b38267d1b52.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.121381087228656,0.0289926128461957,0.0466225687414408,0.0328774377703667,0.0243899514898658,0.0290596480481327,0.0260797278024256,0.0128966299816966,0.016094797058031,0.0150716758798808,0.00998825347051024,0.016439279075712,0.00773464189842343,0.0282889502122998,0.00864043436013162,0.0117908592801541,0.0108941595535725,0.00801771541591734,0.00751721882261336,0.0113933365792036,0.00936738005839288,0.00917564705014229,0.00758136925287545,0.00669747765641659,0.0124597849790007,0.00610188615974039,0.00675451382994652,0.00740061665419489,0.013529681134969,0.00538043223787099,0.0058634108863771,0.0061980375321582,0.0112871392630041,0.00523591740056872,0.006112179486081,0.00631873297970742,0.00712609302718192,0.00576032872777432,0.00520228513050824,0.00838238745927811,0.00592857517767698,0.0067641818895936,0.00472061918117106,0.00696097523905337,0.00535897072404623,0.00632224068976939,0.00461509719025344,0.00472672388423234,0.00485903618391603,0.00565607484895736,0.0066400351934135,0.00433339376468211,0.00472332374192774,0.00661122670862824,0.00511865154840052,0.00533946615178138,0.00414337578695267,0.00463851075619459,0.004586351220496,0.00470439915079623],"mode":"markers+lines","name":"eval","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.178007185459137,0.0551108028739691,0.0345983966611899,0.0317474809976724,0.0287826635803168,0.0219044820047342,0.0242414973103083,0.0195118516970139,0.0198569024841373,0.0175732461592326,0.0184457838678589,0.0127857535934219,0.0154161130866179,0.0113792738948877,0.0160008532066758,0.0111887793128307,0.0130413767810051,0.0128459345119504,0.00899791670963168,0.0117738740518689,0.010124161051443,0.0113964737034761,0.00815677768192612,0.0081835172067468,0.0100849006826488,0.00962175611549845,0.00694748139582001,0.00794698903337121,0.0083109952437763,0.00882133597937914,0.00648390978144912,0.00690347081623398,0.00716124772309111,0.00877142851599134,0.00660272096641935,0.0070246965982593,0.007185609294818,0.00651203661870498,0.00683589172191345,0.00639475885635385,0.00721525626543623,0.00602281365830165,0.00617926499734704,0.00674548369044295,0.00639580344208158,0.00572485075547145,0.00555707682640507,0.006820011131752,0.00542051452570237,0.00567840297634785,0.00602349581626745,0.0057072788835145,0.00545391726952333,0.00562030610700066,0.0059168402535411,0.00501133677048179,0.00513407534274917,0.00595602844483577,0.00502715804255926,0.00509184498626452],"mode":"markers+lines","name":"train","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],"y":[0.121381087228656,0.0289926128461957,0.0466225687414408,0.0328774377703667,0.0243899514898658,0.0290596480481327,0.0260797278024256,0.0128966299816966,0.016094797058031,0.0150716758798808,0.00998825347051024,0.016439279075712,0.00773464189842343,0.0282889502122998,0.00864043436013162,0.0117908592801541,0.0108941595535725,0.00801771541591734,0.00751721882261336,0.0113933365792036,0.00936738005839288,0.00917564705014229,0.00758136925287545,0.00669747765641659,0.0124597849790007,0.00610188615974039,0.00675451382994652,0.00740061665419489,0.013529681134969,0.00538043223787099,0.0058634108863771,0.0061980375321582,0.0112871392630041,0.00523591740056872,0.006112179486081,0.00631873297970742,0.00712609302718192,0.00576032872777432,0.00520228513050824,0.00838238745927811,0.00592857517767698,0.0067641818895936,0.00472061918117106,0.00696097523905337,0.00535897072404623,0.00632224068976939,0.00461509719025344,0.00472672388423234,0.00485903618391603,0.00565607484895736,0.0066400351934135,0.00433339376468211,0.00472332374192774,0.00661122670862824,0.00511865154840052,0.00533946615178138,0.00414337578695267,0.00463851075619459,0.004586351220496,0.00470439915079623],"mode":"markers+lines","name":"eval","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="inference-on-test-data" class="section level2">
<h2>Inference on test data</h2>
<p>Setup inference data. Need to apply preprocessing to inference sequence and convert into a infer data iterator.</p>
<div id="build-the-inference-graph" class="section level3">
<h3>Build the inference graph</h3>
<p>Two graphs are built:</p>
<ol style="list-style-type: decimal">
<li>Graph whose seq length matches the number of timesteps of the inference data. This will provide the state of the model that will subsequently feed the inference iterations.</li>
<li>Graph with a seq length of one used to iterate from the previous prediction state up up to the number of the desired inference steps.</li>
</ol>
<pre class="r"><code>ctx &lt;- mx.cpu()

pred_length = 80
data = mx.nd.array(x[, , 1, drop = F])
infer_length_ini &lt;- dim(data)[2]

symbol.infer.ini &lt;- rnn.graph.unroll(seq_len = infer_length_ini,
                                     num_rnn_layer = 2, 
                                     num_hidden = 50,
                                     input_size = NULL,
                                     num_embed = NULL, 
                                     num_decode = 1,
                                     masking = F, 
                                     loss_output = &quot;linear&quot;,
                                     dropout = 0, 
                                     ignore_label = -1,
                                     cell_type = &quot;lstm&quot;,
                                     output_last_state = T,
                                     config = &quot;one-to-one&quot;)

symbol.infer &lt;- rnn.graph.unroll(seq_len = 1,
                                 num_rnn_layer = 2, 
                                 num_hidden = 50,
                                 input_size = NULL,
                                 num_embed = NULL, 
                                 num_decode = 1,
                                 masking = F, 
                                 loss_output = &quot;linear&quot;,
                                 dropout = 0, 
                                 ignore_label = -1,
                                 cell_type = &quot;lstm&quot;,
                                 output_last_state = T,
                                 config = &quot;one-to-one&quot;)</code></pre>
</div>
<div id="inference" class="section level3">
<h3>Inference</h3>
<pre class="r"><code>predict &lt;- numeric()

infer &lt;- mx.infer.rnn.one.unroll(infer.data = data, 
                                 symbol = symbol.infer.ini,
                                 num_hidden = 50,
                                 arg.params = model$arg.params,
                                 aux.params = model$aux.params,
                                 init_states = NULL,
                                 ctx = ctx)

pred = mx.nd.array(y[seq_len, 1, drop = F])
real = sin(seeds[1] + pi/12 * (seq_len+1):(seq_len+pred_length))

for (i in 1:pred_length) {
  
  data = mx.nd.reshape(pred, shape = c(1,1,1))
  
  infer &lt;- mx.infer.rnn.one.unroll(infer.data = data, 
                                   symbol = symbol.infer,
                                   num_hidden = 50,
                                   arg.params = model$arg.params,
                                   aux.params = model$aux.params,
                                   init_states = infer[-1],
                                   ctx = ctx)
  
  pred &lt;- infer[[1]]
  predict &lt;- c(predict, as.numeric(as.array(pred)))
}</code></pre>
</div>
<div id="plot-predictions-against-real-values" class="section level3">
<h3>Plot predictions against real values</h3>
<pre class="r"><code>data = mx.nd.array(x[, , 1, drop = F])
label = mx.nd.array(y[, 1, drop = F])

plot_ly(x = 1:dim(y)[1], y = y[,1], type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;hist&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(real), y = real, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;real&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(predict), y = predict, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;pred&quot;)</code></pre>
<div id="htmlwidget-0125a744bf536d6c58e1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0125a744bf536d6c58e1">{"x":{"visdat":{"4b38426656fb":["function () ","plotlyVisDat"]},"cur_data":"4b38426656fb","attrs":{"4b38426656fb":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"hist","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b38426656fb.1":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[0.167145510337144,-0.0937278752506381,-0.348213861032726,-0.578969647636044,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.093727875250638,0.348213861032723,0.578969647636047,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252508,0.937415119882691,0.815349095244605,0.637718377193685,0.416628205616462,0.16714551033714,-0.0937278752506343,-0.348213861032723,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193682,-0.416628205616465,-0.167145510337144,0.0937278752506377,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244605,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506341,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244603,-0.637718377193688,-0.416628205616465,-0.167145510337144,0.0937278752506375,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506338,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.90907697049524,-0.985932238226408,-0.995597853252507],"mode":"lines","name":"real","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"4b38426656fb.2":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[0.111003756523132,-0.226189583539963,-0.521971762180328,-0.758978545665741,-0.913849592208862,-0.999349892139435,-1.01940059661865,-0.971809267997742,-0.865266501903534,-0.71337354183197,-0.528415501117706,-0.323148995637894,-0.120334967970848,0.0629491657018661,0.230802997946739,0.391846626996994,0.541308462619781,0.665930807590485,0.75630921125412,0.807091653347015,0.812126457691193,0.765021026134491,0.661300599575043,0.499379634857178,0.278473228216171,-0.00116639956831932,-0.312288850545883,-0.602891623973846,-0.822925627231598,-0.951666414737701,-1.01200330257416,-1.00373840332031,-0.930462062358856,-0.803643643856049,-0.63697075843811,-0.44164577126503,-0.234439834952354,-0.0391892902553082,0.136162832379341,0.300688445568085,0.458191841840744,0.598567068576813,0.709261357784271,0.783282577991486,0.815254807472229,0.79861581325531,0.727591812610626,0.598939478397369,0.411905854940414,0.165135398507118,-0.134080141782761,-0.442115396261215,-0.709148228168488,-0.887643814086914,-0.985714077949524,-1.01689720153809,-0.979694843292236,-0.88175767660141,-0.736282765865326,-0.555955350399017,-0.352707773447037,-0.148125886917114,0.0381455011665821,0.207541018724442,0.369504749774933,0.521382987499237,0.650241911411285,0.745810210704803,0.802528560161591,0.814446747303009,0.775052130222321,0.679505050182343,0.525838911533356,0.313403099775314,0.041477907449007,-0.268450826406479,-0.564732372760773,-0.797822117805481,-0.937846124172211,-1.00757050514221],"mode":"lines","name":"pred","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"hist","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[0.167145510337144,-0.0937278752506381,-0.348213861032726,-0.578969647636044,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.093727875250638,0.348213861032723,0.578969647636047,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252508,0.937415119882691,0.815349095244605,0.637718377193685,0.416628205616462,0.16714551033714,-0.0937278752506343,-0.348213861032723,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193682,-0.416628205616465,-0.167145510337144,0.0937278752506377,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244605,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506341,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244603,-0.637718377193688,-0.416628205616465,-0.167145510337144,0.0937278752506375,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506338,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.90907697049524,-0.985932238226408,-0.995597853252507],"mode":"lines","name":"real","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180],"y":[0.111003756523132,-0.226189583539963,-0.521971762180328,-0.758978545665741,-0.913849592208862,-0.999349892139435,-1.01940059661865,-0.971809267997742,-0.865266501903534,-0.71337354183197,-0.528415501117706,-0.323148995637894,-0.120334967970848,0.0629491657018661,0.230802997946739,0.391846626996994,0.541308462619781,0.665930807590485,0.75630921125412,0.807091653347015,0.812126457691193,0.765021026134491,0.661300599575043,0.499379634857178,0.278473228216171,-0.00116639956831932,-0.312288850545883,-0.602891623973846,-0.822925627231598,-0.951666414737701,-1.01200330257416,-1.00373840332031,-0.930462062358856,-0.803643643856049,-0.63697075843811,-0.44164577126503,-0.234439834952354,-0.0391892902553082,0.136162832379341,0.300688445568085,0.458191841840744,0.598567068576813,0.709261357784271,0.783282577991486,0.815254807472229,0.79861581325531,0.727591812610626,0.598939478397369,0.411905854940414,0.165135398507118,-0.134080141782761,-0.442115396261215,-0.709148228168488,-0.887643814086914,-0.985714077949524,-1.01689720153809,-0.979694843292236,-0.88175767660141,-0.736282765865326,-0.555955350399017,-0.352707773447037,-0.148125886917114,0.0381455011665821,0.207541018724442,0.369504749774933,0.521382987499237,0.650241911411285,0.745810210704803,0.802528560161591,0.814446747303009,0.775052130222321,0.679505050182343,0.525838911533356,0.313403099775314,0.041477907449007,-0.268450826406479,-0.564732372760773,-0.797822117805481,-0.937846124172211,-1.00757050514221],"mode":"lines","name":"pred","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
