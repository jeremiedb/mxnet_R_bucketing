<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Time-Series</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.8.0.9000/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="site_libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-1.40.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotly-main-1.40.1/plotly-latest.min.js"></script>
<script src="site_libs/viz-0.3/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/grViz-binding-1.0.0/grViz.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}

.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
  <div class="container">
  <div class="navbar-header">
  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
    <i class="fa fa-bars fa-lg fa-inverse"></i>
  </button>
  <a class="navbar-brand" href="index.html">MXNET R</a>
  </div>
  
  <div id="navbar" class="collapse navbar-collapse">
  <ul class="nav navbar-nav">
    
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Language Model<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="LanguageModel_GPU.html">GPU</a></li>
        <li><a href="LanguageModel_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">NLP Classification<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="NLP_Classification_GPU.html">GPU</a></li>
        <li><a href="NLP_Classification_CPU.html">CPU</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Time Series<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="TimeSeries_GPU.html">GPU</a></li>
        <li><a href="TimeSeries_CPU.html">CPU</a></li>
        </ul>
  </li>
  
    <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Vision<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="ClassActivationMap.html">Activation Map</a></li>
        </ul>
  </li>
  
  <li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">Translation<b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <li><a href="">GPU</a></li>
        <li><a href="">CPU</a></li>
        </ul>
  </li>
  
  <li><a href="CNN_NLP_Classification.html">CNN NLP Classification</a></li>
  
  </ul>
  
  <ul class="nav navbar-nav navbar-right">
    <li class=navbar-right><a href="mailto:nimus44@gmail.com" ><i class="fa fa-envelope fa-lg"></i></a></li>
    <li class=navbar-right><a href="https://github.com/jeremiedb" ><i class="fa fa-github fa-lg"></i></a></li>
  </ul>
  
  </div><!--/.nav-collapse -->
  </div><!--/.container -->
  </nav><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Time-Series</h1>

</div>


<p>This is a minimalistic demo on how to model time-series with RNN, including training and inference. It uses fused RNN using the <code>mx.symbol.RNN</code> operator. Starting from MXNet 1.3.1, CPU is now supported. On prior versions, needs to be run on GPU.</p>
<pre class="r"><code>library(&quot;readr&quot;)
library(&quot;dplyr&quot;)
library(&quot;plotly&quot;)
library(&quot;mxnet&quot;)</code></pre>
<div id="data-preparation" class="section level3">
<h3>Data preparation</h3>
<p>In this step, a dataset made of multiple univariate time-series is built. 500 independent times series (<em>n</em>) with each 100 observations (<em>seq_len</em>) are created.</p>
<p>The modeling task will be to predict the next value given the previous ones. The target variable can therefore be obtained by shifting the features by one timestep in the future.</p>
<p>The resulting data is of shape [1, 100, 500] corresponding to [num_features, seq_length, samples]. In multivariate time-series, the dataset would follow the same structure, except that the num_features would be &gt; 1.</p>
<pre class="r"><code># number of timestamps
seq_len &lt;- 100

# number of samples
n &lt;- 500

# return a random starting point of the time series
set.seed(12)
seeds &lt;- runif(n, min = 0, max = 24)

# generate the time series of seq_length for each starting point
pts &lt;- sapply(seeds, function(x) sin(x + pi/12 * (0:(seq_len))))

# build the features matrix
x &lt;- pts[1:seq_len, ]
x &lt;- array(x, dim = c(1, seq_len, n))

# build the target array - same as feature but one timestep forward
y &lt;- pts[-1, ]

# plot time series from 5 first samples
plot_ly(x = 1:dim(x)[2], y = x[,,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,2], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,3], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,4], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = x[,,5], type = &quot;scatter&quot;, mode = &quot;lines&quot;) %&gt;% 
  layout(title = &quot;Sample of 5 time series&quot;)</code></pre>
<div id="htmlwidget-5359762f84bab53d6980" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-5359762f84bab53d6980">{"x":{"visdat":{"3d744dce2f65":["function () ","plotlyVisDat"]},"cur_data":"3d744dce2f65","attrs":{"3d744dce2f65":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"3d744dce2f65.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.70117834568943,0.861820608905392,0.963731221850346,0.999965144667347,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700609,0.266874749706372,0.00834921855102572,-0.250745298050841,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456416,-0.712985923799507,-0.507213207700609,-0.266874749706372,-0.00834921855102584,0.25074529805084,0.492751936966736,0.701178345689429,0.861820608905392,0.963731221850346,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799507,0.50721320770061,0.266874749706376,0.00834921855102596,-0.25074529805084,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456418,-0.712985923799507,-0.50721320770061,-0.266874749706373,-0.00834921855102609,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850347,0.999965144667346,0.968053095395803,0.870169827456416,0.71298592379951,0.507213207700607,0.266874749706376,0.00834921855102621,-0.25074529805084,-0.492751936966733,-0.701178345689427,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395804,-0.870169827456414,-0.712985923799508,-0.50721320770061,-0.266874749706373,-0.00834921855102988,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850345,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700613,0.266874749706376,0.00834921855102645,-0.250745298050833,-0.492751936966739,-0.701178345689426,-0.861820608905389,-0.963731221850346,-0.999965144667346,-0.968053095395803,-0.870169827456418,-0.712985923799508,-0.50721320770061,-0.26687474970638,-0.00834921855102302,0.250745298050836,0.492751936966735,0.701178345689429,0.861820608905388,0.963731221850346,0.999965144667346],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"3d744dce2f65.2":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345788,-0.403578406307372,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254405,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.932336886940122,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823962,-0.107963379671007,-0.361590831259314,-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233053,-0.626632013345788,-0.403578406307375,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254402,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823959,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904059,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233055,-0.626632013345785,-0.403578406307375,-0.153021597823963,0.107963379671006,0.36159083125931,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.93233688694012,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823966,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904056,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345791,-0.403578406307376,-0.153021597823963,0.107963379670999,0.361590831259317,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605102,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307379,0.153021597823959,-0.107963379671003,-0.361590831259313,-0.590576465254404,-0.779315289116156,-0.914945063904059,-0.988222844605103],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"3d744dce2f65.3":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.180976961168064,0.429355573857644,0.648474313732461,0.823400600780882,0.942213497619918,0.996816101677582,0.983487335722414,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989953,0.0797349323465505,-0.180976961168064,-0.429355573857644,-0.64847431373246,-0.823400600780882,-0.942213497619917,-0.996816101677582,-0.983487335722414,-0.903135533127433,-0.761236536451854,-0.567460527819938,-0.335013021989954,-0.0797349323465524,0.180976961168064,0.429355573857644,0.64847431373246,0.823400600780882,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989955,0.0797349323465525,-0.180976961168064,-0.429355573857642,-0.64847431373246,-0.823400600780883,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127433,-0.761236536451853,-0.567460527819938,-0.335013021989957,-0.0797349323465527,0.180976961168064,0.429355573857645,0.64847431373246,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451856,0.567460527819938,0.335013021989954,0.0797349323465528,-0.18097696116806,-0.429355573857642,-0.64847431373246,-0.823400600780881,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989957,-0.0797349323465529,0.180976961168063,0.429355573857642,0.648474313732459,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127434,0.761236536451856,0.567460527819939,0.335013021989957,0.079734932346553,-0.180976961168063,-0.429355573857642,-0.648474313732459,-0.82340060078088,-0.942213497619917,-0.996816101677581,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989958,-0.0797349323465531,0.180976961168063,0.429355573857642,0.648474313732462,0.82340060078088],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"3d744dce2f65.4":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871935,-0.921386408957596,-0.78940148493583,-0.603620154263324,-0.376703107607241,-0.124114366699045,0.136932563191003,0.388647765191344,0.613877264264695,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263324,0.376703107607241,0.124114366699045,-0.136932563191002,-0.388647765191345,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607241,-0.124114366699045,0.136932563191002,0.388647765191343,0.613877264264693,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935832,0.603620154263324,0.376703107607242,0.124114366699045,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191344,0.613877264264693,0.797272042258549,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263325,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263326,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191341,0.613877264264693,0.797272042258551,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935833,0.603620154263326,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936],"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Sample of 5 time series","xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.70117834568943,0.861820608905392,0.963731221850346,0.999965144667347,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700609,0.266874749706372,0.00834921855102572,-0.250745298050841,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456416,-0.712985923799507,-0.507213207700609,-0.266874749706372,-0.00834921855102584,0.25074529805084,0.492751936966736,0.701178345689429,0.861820608905392,0.963731221850346,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799507,0.50721320770061,0.266874749706376,0.00834921855102596,-0.25074529805084,-0.492751936966736,-0.701178345689429,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395803,-0.870169827456418,-0.712985923799507,-0.50721320770061,-0.266874749706373,-0.00834921855102609,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850347,0.999965144667346,0.968053095395803,0.870169827456416,0.71298592379951,0.507213207700607,0.266874749706376,0.00834921855102621,-0.25074529805084,-0.492751936966733,-0.701178345689427,-0.86182060890539,-0.963731221850346,-0.999965144667347,-0.968053095395804,-0.870169827456414,-0.712985923799508,-0.50721320770061,-0.266874749706373,-0.00834921855102988,0.250745298050837,0.492751936966736,0.701178345689429,0.861820608905391,0.963731221850345,0.999965144667346,0.968053095395803,0.870169827456416,0.712985923799505,0.507213207700613,0.266874749706376,0.00834921855102645,-0.250745298050833,-0.492751936966739,-0.701178345689426,-0.861820608905389,-0.963731221850346,-0.999965144667346,-0.968053095395803,-0.870169827456418,-0.712985923799508,-0.50721320770061,-0.26687474970638,-0.00834921855102302,0.250745298050836,0.492751936966735,0.701178345689429,0.861820608905388,0.963731221850346,0.999965144667346],"mode":"lines","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345788,-0.403578406307372,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254405,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.932336886940122,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823962,-0.107963379671007,-0.361590831259314,-0.590576465254405,-0.779315289116161,-0.914945063904058,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233053,-0.626632013345788,-0.403578406307375,-0.153021597823962,0.107963379671007,0.361590831259314,0.590576465254402,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823959,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904059,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233055,-0.626632013345785,-0.403578406307375,-0.153021597823963,0.107963379671006,0.36159083125931,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605103,0.994154871561778,0.93233688694012,0.806981684233053,0.626632013345788,0.403578406307372,0.153021597823966,-0.107963379671003,-0.361590831259314,-0.590576465254404,-0.779315289116161,-0.914945063904056,-0.988222844605103,-0.994154871561778,-0.932336886940122,-0.806981684233051,-0.626632013345791,-0.403578406307376,-0.153021597823963,0.107963379670999,0.361590831259317,0.590576465254401,0.779315289116159,0.914945063904058,0.988222844605102,0.994154871561777,0.932336886940123,0.806981684233053,0.626632013345788,0.403578406307379,0.153021597823959,-0.107963379671003,-0.361590831259313,-0.590576465254404,-0.779315289116156,-0.914945063904059,-0.988222844605103],"mode":"lines","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.180976961168064,0.429355573857644,0.648474313732461,0.823400600780882,0.942213497619918,0.996816101677582,0.983487335722414,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989953,0.0797349323465505,-0.180976961168064,-0.429355573857644,-0.64847431373246,-0.823400600780882,-0.942213497619917,-0.996816101677582,-0.983487335722414,-0.903135533127433,-0.761236536451854,-0.567460527819938,-0.335013021989954,-0.0797349323465524,0.180976961168064,0.429355573857644,0.64847431373246,0.823400600780882,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451854,0.567460527819938,0.335013021989955,0.0797349323465525,-0.180976961168064,-0.429355573857642,-0.64847431373246,-0.823400600780883,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127433,-0.761236536451853,-0.567460527819938,-0.335013021989957,-0.0797349323465527,0.180976961168064,0.429355573857645,0.64847431373246,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127433,0.761236536451856,0.567460527819938,0.335013021989954,0.0797349323465528,-0.18097696116806,-0.429355573857642,-0.64847431373246,-0.823400600780881,-0.942213497619917,-0.996816101677582,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989957,-0.0797349323465529,0.180976961168063,0.429355573857642,0.648474313732459,0.823400600780881,0.942213497619917,0.996816101677582,0.983487335722415,0.903135533127434,0.761236536451856,0.567460527819939,0.335013021989957,0.079734932346553,-0.180976961168063,-0.429355573857642,-0.648474313732459,-0.82340060078088,-0.942213497619917,-0.996816101677581,-0.983487335722415,-0.903135533127434,-0.761236536451856,-0.567460527819939,-0.335013021989958,-0.0797349323465531,0.180976961168063,0.429355573857642,0.648474313732462,0.82340060078088],"mode":"lines","type":"scatter","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871935,-0.921386408957596,-0.78940148493583,-0.603620154263324,-0.376703107607241,-0.124114366699045,0.136932563191003,0.388647765191344,0.613877264264695,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263324,0.376703107607241,0.124114366699045,-0.136932563191002,-0.388647765191345,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607241,-0.124114366699045,0.136932563191002,0.388647765191343,0.613877264264693,0.797272042258551,0.926334048126834,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935832,0.603620154263324,0.376703107607242,0.124114366699045,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126834,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263325,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191344,0.613877264264693,0.797272042258549,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935831,0.603620154263325,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936,-0.921386408957596,-0.789401484935831,-0.603620154263326,-0.376703107607242,-0.124114366699047,0.136932563191002,0.388647765191341,0.613877264264693,0.797272042258551,0.926334048126833,0.992267919454668,0.990580371871936,0.921386408957596,0.789401484935833,0.603620154263326,0.376703107607242,0.124114366699047,-0.136932563191002,-0.388647765191341,-0.613877264264693,-0.797272042258551,-0.926334048126833,-0.992267919454668,-0.990580371871936],"mode":"lines","type":"scatter","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"line":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<pre class="r"><code># plot first time series and its associated target
plot_ly(x = 1:dim(x)[2], y = x[,,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;, name = &quot;feature&quot;) %&gt;% 
  add_trace(x = 1:dim(x)[2], y = y[,1], type = &quot;scatter&quot;, mode = &quot;lines&quot;, name = &quot;target&quot;) %&gt;% 
  layout(title = &quot;Sample of one time series&quot;)</code></pre>
<div id="htmlwidget-a74b8cf5905f19d81eab" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-a74b8cf5905f19d81eab">{"x":{"visdat":{"3d74710a810":["function () ","plotlyVisDat"]},"cur_data":"3d74710a810","attrs":{"3d74710a810":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","name":"feature","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"3d74710a810.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"target","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Sample of one time series","xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.995597853252507,0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685],"mode":"lines","name":"feature","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"target","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="create-data-iterators" class="section level3">
<h3>Create data iterators</h3>
<p>The training and evaluation data are obtained by splitting the first 400 and the remaining observations into different <code>mx.io.arrayiter</code> iterators.</p>
<pre class="r"><code>batch.size = 32

# take first 400 samples for train - remaining 100 for evaluation
train_ids &lt;- 1:400

train.data &lt;- mx.io.arrayiter(data = x[,,train_ids, drop = F], label = y[, train_ids], 
                              batch.size = batch.size, shuffle = TRUE)

eval.data &lt;- mx.io.arrayiter(data = x[,,-train_ids, drop = F], label = y[, -train_ids], 
                              batch.size = batch.size, shuffle = FALSE)</code></pre>
</div>
<div id="model-architecture" class="section level3">
<h3>Model architecture</h3>
<pre class="r"><code>data &lt;- mx.symbol.Variable(&quot;data&quot;)
label &lt;- mx.symbol.Variable(&quot;label&quot;)
parameters &lt;- mx.symbol.Variable(&quot;rnn_weight&quot;)
rnn_input_state &lt;- mx.symbol.Variable(&quot;rnn_input_state&quot;)
rnn_input_state_cell &lt;- mx.symbol.Variable(&quot;rnn_input_state_cell&quot;)

swap_in &lt;- mx.symbol.swapaxes(data, dim1 = 0, dim2 = 1)
RNN &lt;- mx.symbol.RNN(data = swap_in, 
                     parameters = parameters,
                     state = rnn_input_state,
                     state_cell = rnn_input_state_cell,
                     state_size = 32, 
                     num_layers = 2,
                     p = 0.1,
                     bidirectional = F,
                     state_outputs = T,
                     mode = &quot;lstm&quot;,
                     name = &quot;RNN&quot;)
swap_out &lt;- mx.symbol.swapaxes(data = RNN[[1]], dim1 = 0, dim2 = 1)
decode &lt;- mx.symbol.FullyConnected(data = swap_out, num_hidden = 1, flatten = F)
decode &lt;- mx.symbol.reshape(decode, shape = c(1, -1))
label &lt;- mx.symbol.reshape(label, shape = -1)
loss &lt;- mx.symbol.LinearRegressionOutput(data = decode, label = label, name = &quot;loss&quot;)

graph.viz(symbol = loss, type = &quot;graph&quot;, direction = &quot;LR&quot;, 
          shape=list(data = c(1, seq_len, batch.size), 
                     label = c(seq_len, batch.size)),
          graph.width.px = 800, graph.height.px = 220)</code></pre>
<div id="htmlwidget-8cb4f54447ec53827770" style="width:800px;height:220px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8cb4f54447ec53827770">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"LR\"]\n\n\n\n  \"1\" [label = \"data\ndata\", shape = \"oval\", penwidth = \"2\", color = \"#8dd3c7\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#8DD3C7FF\"] \n  \"2\" [label = \"SwapAxis\nswapaxes0\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"3\" [label = \"RNN\nRNN\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"4\" [label = \"SwapAxis\nswapaxes1\", shape = \"box\", penwidth = \"2\", color = \"#fccde5\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FCCDE5FF\"] \n  \"5\" [label = \"FullyConnected\nfullyconnected0\n1\", shape = \"box\", penwidth = \"2\", color = \"#fb8072\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FB8072FF\"] \n  \"6\" [label = \"Reshape\nreshape0\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"7\" [label = \"Reshape\nreshape1\", shape = \"oval\", penwidth = \"2\", color = \"#fdb462\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#FDB462FF\"] \n  \"8\" [label = \"LinearRegressionOutput\nloss\", shape = \"box\", penwidth = \"2\", color = \"#b3de69\", style = \"filled\", fontcolor = \"black\", fillcolor = \"#B3DE69FF\"] \n\"1\"->\"2\" [color = \"black\", fontcolor = \"black\", label = \"1X100X32\"] \n\"2\"->\"3\" [color = \"black\", fontcolor = \"black\", label = \"1X32X100\"] \n\"3\"->\"4\" [color = \"black\", fontcolor = \"black\", label = \"32X32X100\"] \n\"4\"->\"5\" [color = \"black\", fontcolor = \"black\", label = \"32X100X32\"] \n\"5\"->\"6\" [color = \"black\", fontcolor = \"black\", label = \"1X100X32\"] \n\"6\"->\"8\" [color = \"black\", fontcolor = \"black\", label = \"1X3200\"] \n\"7\"->\"8\" [color = \"black\", fontcolor = \"black\", label = \"3200\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="fit-a-lstm-model" class="section level3">
<h3>Fit a LSTM model</h3>
<p>Needs a custom metric to handle labels in a matrix rather than flat format in the iterator.</p>
<pre class="r"><code>mx.metric.mse.seq &lt;- mx.metric.custom(&quot;MSE&quot;, function(label, pred) {
  label &lt;- mx.nd.reshape(label, shape = -1)
  pred &lt;- mx.nd.reshape(pred, shape = -1)
  res &lt;- mx.nd.mean(mx.nd.square(label-pred))
  return(as.array(res))
})</code></pre>
<pre class="r"><code>ctx &lt;- mx.gpu()

initializer &lt;- mx.init.Xavier(rnd_type = &quot;gaussian&quot;, 
                              factor_type = &quot;avg&quot;, 
                              magnitude = 2.5)

optimizer &lt;- mx.opt.create(&quot;adam&quot;, learning.rate = 1e-3, beta1 = 0.9, beta2 = 0.999, 
                           wd = 1e-8, clip_gradient = 1, rescale.grad = 1 / batch.size)

logger &lt;- mx.metric.logger()
epoch.end.callback &lt;- mx.callback.log.train.metric(period = 10, logger = logger)

system.time(
  model &lt;- mx.model.buckets(symbol = loss,
                            train.data = train.data, 
                            eval.data = eval.data, 
                            num.round = 50, ctx = ctx, verbose = TRUE,
                            metric = mx.metric.mse.seq, 
                            initializer = initializer, optimizer = optimizer, 
                            batch.end.callback = NULL, 
                            epoch.end.callback = epoch.end.callback)
)</code></pre>
<pre><code>##    user  system elapsed 
##   13.93    4.24   18.71</code></pre>
<pre class="r"><code>plot_ly(x = seq_len(length(logger$train)), y = logger$train, type = &quot;scatter&quot;, 
        mode = &quot;markers+lines&quot;, name = &quot;train&quot;) %&gt;% 
  add_trace(y = logger$eval, type = &quot;scatter&quot;, 
            mode = &quot;markers+lines&quot;, name = &quot;eval&quot;)</code></pre>
<div id="htmlwidget-9c178ac47f0bf5ab798d" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9c178ac47f0bf5ab798d">{"x":{"visdat":{"3d741e785a9":["function () ","plotlyVisDat"]},"cur_data":"3d741e785a9","attrs":{"3d741e785a9":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[0.387411736525022,0.0345958859588091,0.0115327585058717,0.0073291864962532,0.00598311495895569,0.00532470940827177,0.00482286974930993,0.00447725966716042,0.00420885461454208,0.00390114337922289,0.00376458093523979,0.00352358773279075,0.00336559147287447,0.0031369614880532,0.00301858795305284,0.00285996142058418,0.00277571004027357,0.00261422959514535,0.00253638257988943,0.00243425245683354,0.00233154554063311,0.0022747062612325,0.00220595906452777,0.00216745593262693,0.00212038539421673,0.00206774591396634,0.00205740603940705,0.00200246445512256,0.00197896424036186,0.00196210719430103,0.00186482529478291,0.00188853275568153,0.0018552305141034,0.00184132263530046,0.00183415967218864,0.00180940807331353,0.00181608587109412,0.00179373942172298,0.00176053593615786,0.00175752318822421,0.00172911174237155,0.00166006900298481,0.00167483551642643,0.00168659291767444,0.00167370808776468,0.00165415769263815,0.00165031297812955,0.001604056935041,0.00158969824238179,0.00158375701329742],"mode":"markers+lines","name":"train","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"3d741e785a9.1":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[0.115887258201838,0.00824318802915514,0.00395514909178019,0.00306597392773256,0.00287502305582166,0.00254739978117868,0.00237147184088826,0.00222731224494055,0.00209293584339321,0.00196202995721251,0.00183606072096154,0.00173422592342831,0.00163509073900059,0.00156054741819389,0.0014573359512724,0.00137587729841471,0.00131214421708137,0.00124366188538261,0.00120071871788241,0.0011555241944734,0.00108438174356706,0.00105857686139643,0.00102999329101294,0.00101266962883528,0.000987711100606248,0.000969449843978509,0.000969111773883924,0.000944274666835554,0.00095175021851901,0.000984420257736929,0.000916180812055245,0.000909993759705685,0.000900010025361553,0.000928145411307923,0.000898573329322971,0.000894375538337044,0.000885311324964277,0.000876765567227267,0.000881690037203953,0.000874107587151229,0.000853955512866378,0.000865337846335024,0.000853044810355641,0.000842533190734684,0.000839247979456559,0.000854886151500978,0.000828313874080777,0.00084311215323396,0.000853318590088747,0.000865672627696767],"mode":"markers+lines","name":"eval","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[0.387411736525022,0.0345958859588091,0.0115327585058717,0.0073291864962532,0.00598311495895569,0.00532470940827177,0.00482286974930993,0.00447725966716042,0.00420885461454208,0.00390114337922289,0.00376458093523979,0.00352358773279075,0.00336559147287447,0.0031369614880532,0.00301858795305284,0.00285996142058418,0.00277571004027357,0.00261422959514535,0.00253638257988943,0.00243425245683354,0.00233154554063311,0.0022747062612325,0.00220595906452777,0.00216745593262693,0.00212038539421673,0.00206774591396634,0.00205740603940705,0.00200246445512256,0.00197896424036186,0.00196210719430103,0.00186482529478291,0.00188853275568153,0.0018552305141034,0.00184132263530046,0.00183415967218864,0.00180940807331353,0.00181608587109412,0.00179373942172298,0.00176053593615786,0.00175752318822421,0.00172911174237155,0.00166006900298481,0.00167483551642643,0.00168659291767444,0.00167370808776468,0.00165415769263815,0.00165031297812955,0.001604056935041,0.00158969824238179,0.00158375701329742],"mode":"markers+lines","name":"train","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[0.115887258201838,0.00824318802915514,0.00395514909178019,0.00306597392773256,0.00287502305582166,0.00254739978117868,0.00237147184088826,0.00222731224494055,0.00209293584339321,0.00196202995721251,0.00183606072096154,0.00173422592342831,0.00163509073900059,0.00156054741819389,0.0014573359512724,0.00137587729841471,0.00131214421708137,0.00124366188538261,0.00120071871788241,0.0011555241944734,0.00108438174356706,0.00105857686139643,0.00102999329101294,0.00101266962883528,0.000987711100606248,0.000969449843978509,0.000969111773883924,0.000944274666835554,0.00095175021851901,0.000984420257736929,0.000916180812055245,0.000909993759705685,0.000900010025361553,0.000928145411307923,0.000898573329322971,0.000894375538337044,0.000885311324964277,0.000876765567227267,0.000881690037203953,0.000874107587151229,0.000853955512866378,0.000865337846335024,0.000853044810355641,0.000842533190734684,0.000839247979456559,0.000854886151500978,0.000828313874080777,0.00084311215323396,0.000853318590088747,0.000865672627696767],"mode":"markers+lines","name":"eval","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="inference-on-test-data" class="section level2">
<h2>Inference on test data</h2>
<p>Setup inference data. Need to apply preprocessing to inference sequence and convert into a infer data iterator.</p>
<div id="inference" class="section level3">
<h3>Inference</h3>
<pre class="r"><code>internals &lt;- model$symbol$get.internals()
sym_state &lt;- internals$get.output(which(internals$outputs %in% &quot;RNN_state&quot;))
sym_state_cell &lt;- internals$get.output(which(internals$outputs %in% &quot;RNN_state_cell&quot;))
sym_output &lt;- internals$get.output(which(internals$outputs %in% &quot;loss_output&quot;))
symbol &lt;- mx.symbol.Group(sym_output, sym_state, sym_state_cell)

pred_length = 100
predict &lt;- numeric()

data &lt;- mx.nd.array(x[, , 1, drop = F])
label &lt;- mx.nd.array(y[, 1, drop = F])

pred &lt;- mx.nd.array(y[seq_len, 1, drop = F])
real &lt;- sin(seeds[1] + pi/12 * (seq_len+1):(seq_len+pred_length))

infer.data &lt;- mx.io.arrayiter(data = data, label = label, 
                              batch.size = 1, shuffle = FALSE)

infer &lt;- mx.infer.rnn.one(infer.data = infer.data, 
                          symbol = symbol,
                          arg.params = model$arg.params, 
                          aux.params = model$aux.params, 
                          input.params = NULL,
                          ctx = ctx)

for (i in 1:pred_length) {
  
  data &lt;- mx.nd.reshape(pred, shape = c(1,1,1))
  label &lt;- pred
  
  infer.data &lt;- mx.io.arrayiter(data = data, label = label,  
                                batch.size = 1, shuffle = FALSE)
  
  infer &lt;- mx.infer.rnn.one(infer.data = infer.data, 
                            symbol = symbol,
                            ctx = ctx,
                            arg.params = model$arg.params,
                            aux.params = model$aux.params,
                            input.params = list(rnn_input_state = infer[[2]], 
                                                rnn_input_state_cell = infer[[3]]))
  
  pred &lt;- infer[[1]]
  predict &lt;- c(predict, as.numeric(as.array(pred)))
  
}</code></pre>
</div>
<div id="plot-predictions-against-real-values" class="section level3">
<h3>Plot predictions against real values</h3>
<pre class="r"><code>data &lt;- mx.nd.array(x[, , 1, drop = F])
label &lt;- mx.nd.array(y[, 1, drop = F])

plot_ly(x = 1:dim(y)[1], y = y[,1], type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;hist&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(real), y = real, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;real&quot;) %&gt;% 
  add_trace(x = dim(y)[1] + 1:length(predict), y = predict, type = &quot;scatter&quot;, mode=&quot;lines&quot;, name = &quot;pred&quot;)</code></pre>
<div id="htmlwidget-0125a744bf536d6c58e1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0125a744bf536d6c58e1">{"x":{"visdat":{"3d74297137f5":["function () ","plotlyVisDat"]},"cur_data":"3d74297137f5","attrs":{"3d74297137f5":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"hist","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"3d74297137f5.1":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],"y":[0.167145510337144,-0.0937278752506381,-0.348213861032726,-0.578969647636044,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.093727875250638,0.348213861032723,0.578969647636047,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252508,0.937415119882691,0.815349095244605,0.637718377193685,0.416628205616462,0.16714551033714,-0.0937278752506343,-0.348213861032723,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193682,-0.416628205616465,-0.167145510337144,0.0937278752506377,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244605,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506341,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244603,-0.637718377193688,-0.416628205616465,-0.167145510337144,0.0937278752506375,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506338,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.90907697049524,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244604,-0.637718377193688,-0.416628205616466,-0.167145510337144,0.0937278752506372,0.348213861032725,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193686,0.416628205616463,0.167145510337148,-0.0937278752506336,-0.348213861032722,-0.578969647636044],"mode":"lines","name":"real","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true},"3d74297137f5.2":{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],"y":[0.174639478325844,-0.0788594484329224,-0.326547563076019,-0.55083841085434,-0.734990775585175,-0.86567485332489,-0.934411406517029,-0.937853038311005,-0.877183496952057,-0.757191181182861,-0.585513234138489,-0.372303903102875,-0.130287513136864,0.125126570463181,0.376201599836349,0.604208946228027,0.791730940341949,0.92512047290802,0.996012628078461,1.00142228603363,0.942864000797272,0.82527220249176,0.656262516975403,0.445869714021683,0.206597223877907,-0.0465480498969555,-0.296445369720459,-0.525033533573151,-0.715276300907135,-0.853340983390808,-0.930130004882812,-0.941696763038635,-0.888726532459259,-0.77562028169632,-0.609698414802551,-0.40081375837326,-0.161370724439621,0.093539297580719,0.346403688192368,0.578488707542419,0.772054970264435,0.91286563873291,0.991863131523132,1.00543236732483,0.954596221446991,0.843920171260834,0.680714905261993,0.474718540906906,0.238124623894691,-0.0143588110804558,-0.265822112560272,-0.498217761516571,-0.694247782230377,-0.839565396308899,-0.924428641796112,-0.944257974624634,-0.899207293987274,-0.793264329433441,-0.633417248725891,-0.429209798574448,-0.192720055580139,0.0612924844026566,0.31556910276413,0.551415383815765,0.750813782215118,0.898960530757904,0.986099123954773,1.00795912742615,0.965044140815735,0.861530005931854,0.704411029815674,0.503124594688416,0.269550025463104,0.0180857963860035,-0.234592333436012,-0.470486134290695,-0.672073900699615,-0.824520111083984,-0.917441368103027,-0.945611238479614,-0.90863049030304,-0.81005471944809,-0.656527817249298,-0.457279950380325,-0.224061265587807,0.0287085957825184,0.284047722816467,0.52334064245224,0.728336155414581,0.883691430091858,0.978952646255493,1.00917553901672,0.974319577217102,0.878152549266815,0.727343440055847,0.531026005744934,0.300763964653015,0.0506393983960152,-0.20292454957962,-0.442011386156082],"mode":"lines","name":"pred","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"y":[0.937415119882691,0.815349095244602,0.637718377193682,0.41662820561646,0.16714551033714,-0.0937278752506408,-0.348213861032727,-0.578969647636047,-0.770269609545552,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.41662820561646,-0.16714551033714,0.0937278752506407,0.348213861032727,0.578969647636047,0.770269609545552,0.909076970495243,0.985932238226409,0.995597853252507,0.937415119882691,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337139,-0.0937278752506388,-0.348213861032727,-0.578969647636047,-0.770269609545551,-0.909076970495242,-0.985932238226409,-0.995597853252507,-0.937415119882691,-0.815349095244603,-0.637718377193683,-0.416628205616461,-0.167145510337141,0.0937278752506405,0.348213861032727,0.578969647636046,0.770269609545551,0.909076970495242,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193683,0.416628205616461,0.167145510337141,-0.0937278752506386,-0.348213861032727,-0.578969647636045,-0.770269609545551,-0.909076970495243,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193684,-0.416628205616461,-0.16714551033714,0.0937278752506385,0.348213861032727,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616461,0.16714551033714,-0.0937278752506383,-0.348213861032726,-0.578969647636045,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.0937278752506382,0.348213861032726,0.578969647636045,0.770269609545551,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882692,0.815349095244603,0.637718377193685,0.416628205616462],"mode":"lines","name":"hist","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],"y":[0.167145510337144,-0.0937278752506381,-0.348213861032726,-0.578969647636044,-0.770269609545551,-0.909076970495241,-0.985932238226409,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193685,-0.416628205616462,-0.167145510337144,0.093727875250638,0.348213861032723,0.578969647636047,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252508,0.937415119882691,0.815349095244605,0.637718377193685,0.416628205616462,0.16714551033714,-0.0937278752506343,-0.348213861032723,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882692,-0.815349095244603,-0.637718377193682,-0.416628205616465,-0.167145510337144,0.0937278752506377,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244605,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506341,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.909076970495243,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244603,-0.637718377193688,-0.416628205616465,-0.167145510337144,0.0937278752506375,0.348213861032726,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193685,0.416628205616462,0.167145510337141,-0.0937278752506338,-0.348213861032722,-0.578969647636044,-0.77026960954555,-0.90907697049524,-0.985932238226408,-0.995597853252507,-0.937415119882693,-0.815349095244604,-0.637718377193688,-0.416628205616466,-0.167145510337144,0.0937278752506372,0.348213861032725,0.578969647636041,0.770269609545548,0.909076970495241,0.985932238226409,0.995597853252507,0.937415119882694,0.815349095244606,0.637718377193686,0.416628205616463,0.167145510337148,-0.0937278752506336,-0.348213861032722,-0.578969647636044],"mode":"lines","name":"real","type":"scatter","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],"y":[0.174639478325844,-0.0788594484329224,-0.326547563076019,-0.55083841085434,-0.734990775585175,-0.86567485332489,-0.934411406517029,-0.937853038311005,-0.877183496952057,-0.757191181182861,-0.585513234138489,-0.372303903102875,-0.130287513136864,0.125126570463181,0.376201599836349,0.604208946228027,0.791730940341949,0.92512047290802,0.996012628078461,1.00142228603363,0.942864000797272,0.82527220249176,0.656262516975403,0.445869714021683,0.206597223877907,-0.0465480498969555,-0.296445369720459,-0.525033533573151,-0.715276300907135,-0.853340983390808,-0.930130004882812,-0.941696763038635,-0.888726532459259,-0.77562028169632,-0.609698414802551,-0.40081375837326,-0.161370724439621,0.093539297580719,0.346403688192368,0.578488707542419,0.772054970264435,0.91286563873291,0.991863131523132,1.00543236732483,0.954596221446991,0.843920171260834,0.680714905261993,0.474718540906906,0.238124623894691,-0.0143588110804558,-0.265822112560272,-0.498217761516571,-0.694247782230377,-0.839565396308899,-0.924428641796112,-0.944257974624634,-0.899207293987274,-0.793264329433441,-0.633417248725891,-0.429209798574448,-0.192720055580139,0.0612924844026566,0.31556910276413,0.551415383815765,0.750813782215118,0.898960530757904,0.986099123954773,1.00795912742615,0.965044140815735,0.861530005931854,0.704411029815674,0.503124594688416,0.269550025463104,0.0180857963860035,-0.234592333436012,-0.470486134290695,-0.672073900699615,-0.824520111083984,-0.917441368103027,-0.945611238479614,-0.90863049030304,-0.81005471944809,-0.656527817249298,-0.457279950380325,-0.224061265587807,0.0287085957825184,0.284047722816467,0.52334064245224,0.728336155414581,0.883691430091858,0.978952646255493,1.00917553901672,0.974319577217102,0.878152549266815,0.727343440055847,0.531026005744934,0.300763964653015,0.0506393983960152,-0.20292454957962,-0.442011386156082],"mode":"lines","name":"pred","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
